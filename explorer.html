<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Data Explorer - Artfictions</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
  <style>
    .chart-container { margin: 2rem 0; }
    .chart-title { font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem; }
    #dashboard .stat-card { text-align: center; }
    svg { width: 100%; height: 400px; }
  </style>
</head>
<body>
<main>
  <a href="index.html" class="back-link">← Back to Catalogue</a>
  <h1>Data Explorer</h1>

  <!-- Controls -->
  <div class="controls">
    <div class="control-group">
      <label for="dimSelect">Dimension</label>
      <select id="dimSelect">
        <option value="themes">Themes</option>
        <option value="countries">Countries</option>
        <option value="languages">Languages</option>
        <option value="years">Years (Decades)</option>
      </select>
    </div>
    <div class="control-group">
      <label for="filterSelect">Filter by</label>
      <select id="filterSelect">
        <option value="none">None</option>
        <option value="country">Country</option>
        <option value="language">Language</option>
      </select>
    </div>
  </div>

  <!-- Statistical Dashboards -->
  <section id="dashboard" class="chart-container">
    <h2 class="chart-title">Breakdown by Selected Dimension</h2>
    <div id="pieCharts" class="stats"></div>
  </section>

  <!-- Temporal Visualisations -->
  <section id="temporal" class="chart-container">
    <h2 class="chart-title">Moving Average Trends over Decades</h2>
    <svg id="trendChart"></svg>
  </section>

  <!-- Geographic Visualisations -->
  <section id="geographic" class="chart-container">
    <h2 class="chart-title">Sankey Diagram: Theme ↔︎ Country/Author</h2>
    <svg id="sankeyChart"></svg>
  </section>

  <!-- Cross-dimensional Views -->
  <section id="crossDim" class="chart-container">
    <h2 class="chart-title">Parallel Coordinates</h2>
    <svg id="parallelChart"></svg>
    <h2 class="chart-title">Chord Diagram: Relationships</h2>
    <svg id="chordChart"></svg>
  </section>

</main>

<!-- D3.js and Sankey plugin -->
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-sankey@0.12.3/dist/d3-sankey.min.js"></script>
<script>
// Load and preprocess data
Promise.all([
  d3.json('artfictions_novels.json')
]).then(([data]) => {
  // Extract themes and other fields
  data = data.Novels || data;
  data.forEach(d => {
    d.themes = [];
    for (let i = 1; i <= 5; i++) {
      const key = 'Theme ' + i;
      if (d[key] && d[key].trim()) d.themes.push(d[key].trim());
    }
    d.decade = +d['Year of Publication'] ? Math.floor(d['Year of Publication']/10)*10 : 'Unknown';
  });

  createPieCharts(data);
  createTrendChart(data);
  createSankeyDiagram(data);
  createParallelCoordinates(data);
  createChordDiagram(data);
});

function createPieCharts(data) {
  const dim = document.getElementById('dimSelect').value;
  const counts = d3.rollup(data, v => v.length, d => d[capitalize(dim)]);
  const pie = d3.pie().value(d => d[1]);
  const arcs = pie(Array.from(counts));
  const width = 200, height = 200, radius = Math.min(width, height)/2;
  const color = d3.scaleOrdinal(d3.schemeCategory10);

  const container = d3.select('#pieCharts').html('');
  arcs.forEach((arcData, i) => {
    const svg = container.append('svg')
      .attr('width', width)
      .attr('height', height)
      .append('g')
        .attr('transform', `translate(${radius},${radius})`);
    const arcGen = d3.arc().innerRadius(radius*0.5).outerRadius(radius);
    svg.selectAll('path')
      .data([arcData])
      .join('path')
      .attr('d', arcGen)
      .attr('fill', () => color(i));
    svg.append('text')
      .attr('text-anchor', 'middle')
      .attr('dy', '.35em')
      .text(arcData.data[0]);
  });
}

function createTrendChart(data) {
  // TODO: compute moving averages of theme counts per decade and draw line chart
}

function createSankeyDiagram(data) {
  // TODO: build sankey layout for theme-country or theme-author
}

function createParallelCoordinates(data) {
  // TODO: draw parallel coordinates connecting country, language, decade, theme count
}

function createChordDiagram(data) {
  // TODO: compute relationship matrix and draw chord diagram
}

function capitalize(s) {
  return s.charAt(0).toUpperCase() + s.slice(1);
}
</script>
</body>
</html>
